\documentclass[
$if(chapter)$
  chapter,
$endif$
$if(print)$
  print,
$endif$
$if(lineno)$
  lineno,
$endif$
$if(index)$
  index,
$endif$
$if(papersize)$
  $papersize$,
$endif$
$if(page-layout)$
  $page-layout$,
$endif$
$if(page-style)$
  $page-style$,
$endif$
$if(flushleft)$
  flushleft,
$endif$
$if(geometry)$
  custommargin,
$endif$
$if(fontsize)$
  $fontsize$,
$endif$
$if(fontfamily)$
  $fontfamily$,
$endif$
]{PhDThesisPSnPDF}

\ifsetCustomMargin
  \usepackage[$for(geometry)$$geometry$$sep$,$endfor$]{geometry}
  \setFancyHdr
\fi

\raggedbottom

% From {rticles}
$if(csl-refs)$
\newlength{\csllabelwidth}
\setlength{\csllabelwidth}{1.5em}
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}
% for Pandoc 2.8 to 2.10.1
\newenvironment{cslreferences}%
  {$if(csl-hanging-indent)$\setlength{\parindent}{0pt}%
  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces$endif$}%
  {\par}
% For Pandoc 2.11+
% As noted by @mirh [2] is needed instead of [3] for 2.12
\newenvironment{CSLReferences}[2] % #1 hanging-ident, #2 entry spacing
 {% don't indent paragraphs
  \setlength{\parindent}{0pt}
  % turn on hanging indent if param 1 is 1
  \ifodd #1 \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces\fi
  % set entry spacing
  \ifnum #2 > 0
  \setlength{\parskip}{#2\baselineskip}
  \fi
 }%
 {}
\usepackage{calc} % for calculating minipage widths
\newcommand{\CSLBlock}[1]{#1\hfill\break}
\newcommand{\CSLLeftMargin}[1]{\parbox[t]{\csllabelwidth}{#1}}
\newcommand{\CSLRightInline}[1]{\parbox[t]{\linewidth - \csllabelwidth}{#1}}
\newcommand{\CSLIndent}[1]{\hspace{\cslhangindent}#1}
$endif$

% Fix 'Environment Shaded undefined' error
% see https://stackoverflow.com/questions/41052687
$if(highlighting-macros)$
$highlighting-macros$
$endif$

% Fix 'Undefined control sequence. \tightlist' error
% see https://stackoverflow.com/questions/40438037
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}

\title{$title$}
\subtitle{$subtitle$}

\author{$author$}

\dept{$dept$}

\college{$college$}
\university{$university$}
\crest{\includegraphics[width=$university-crest-width$]{$university-crest$}}

$if(college-shield)$
\collegeshield{\includegraphics[width=$college-shield-width$]{$college-shield$}}
$endif$

$if(supervisor)$
\supervisor{$supervisor$}
\supervisorlinewidth{$supervisor-linewidth$}
$endif$

$if(supervisor-role)$
\supervisorrole{$supervisor-role$}
$endif$

$if(advisor)$
\advisor{$advisor$}
\advisorlinewidth{$advisor-linewidth$}
$endif$

$if(advisor-role)$
\advisorrole{$advisor-role$}
$endif$

\degreetitle{$degree-title$}

\degreedate{$date$}

\begin{document}

\maketitle

\frontmatter

$if(chapter)$
  % Do nothing
$else$
\begin{dedication}
  $dedication$
\end{dedication}

\begin{declaration}
  $declaration$
\end{declaration}

\begin{acknowledgements}
  $acknowledgements$
\end{acknowledgements}

\begin{abstract}
  $abstract$
\end{abstract}
$endif$

\tableofcontents

\listoffigures

\listoftables

\printnomenclature

\mainmatter

$body$

\printthesisindex

\end{document}
